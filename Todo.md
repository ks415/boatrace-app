# ボートレース特定選手特化アプリケーション開発 TODO

## 現在の状況

- ✅ 基本的なレースデータ取得 API（プログラム、オッズ、結果、予想、競艇場情報）が実装済み
- ✅ React フロントエンドでデータ表示の基本機能が実装済み
- ✅ bvp-scraper-python を使用したデータ取得基盤が構築済み

## Phase 1: 選手中心のデータ構造と API 実装

### 1. バックエンド: 選手関連 API 実装

- [ ] 選手検索エンドポイント実装 (`/api/racers/search`)
  - 選手名での部分検索
  - 登録番号での検索
  - 出身地、年齢等の条件検索
- [ ] 選手詳細情報エンドポイント実装 (`/api/racers/{racer_number}`)
  - 基本情報（名前、年齢、出身地、級別等）
  - 現在の成績データ
- [ ] 選手の過去成績エンドポイント実装 (`/api/racers/{racer_number}/results`)
  - 年別、場別、コース別の絞り込み機能
  - ページネーション対応
- [ ] 選手の出走予定エンドポイント実装 (`/api/racers/{racer_number}/upcoming`)
  - 今後の出走レース一覧
  - 日付範囲指定機能

### 2. データベース設計と実装

- [ ] 選手情報保存用データベーススキーマ設計
  - 選手基本情報テーブル
  - 成績履歴テーブル
  - お気に入り選手テーブル（ユーザー管理機能含む）
- [ ] データベース接続と ORM 設定（SQLAlchemy 等）
- [ ] 定期的なデータ更新機能実装（選手情報の同期）

### 3. 選手成績分析機能

- [ ] 成績統計計算機能実装
  - コース別勝率
  - 2 連対率、3 連対率
  - 平均スタートタイミング
  - 決まり手統計
- [ ] 統計データ提供 API 実装 (`/api/racers/{racer_number}/stats`)
  - 既定の集計期間: 1 年（?range=1y をデフォルト）

## Phase 2: フロントエンド選手特化 UI 実装

### 4. 選手検索・選択機能

- [ ] 選手検索画面実装
  - 検索フォーム（名前、登録番号）
  - 検索結果一覧表示
  - 選手カード形式での表示
- [ ] 選手詳細ページ実装
  - 選手基本情報表示
  - タブ切り替え UI（成績、出走予定、統計等）

### 5. 過去成績表示機能

- [ ] Recharts を導入（グラフ描画ライブラリ）
- [ ] 成績一覧テーブル実装
  - ソート、フィルタリング機能
  - 詳細な絞り込み条件 UI
- [ ] 成績グラフ表示実装
  - コース別勝率円グラフ
  - 月別成績推移グラフ
  - 決まり手分布グラフ

### 6. お気に入り選手機能

- [ ] お気に入り選手登録/削除機能
- [ ] お気に入り選手一覧ページ
- [ ] 選手ページでのお気に入り状態表示
  - 初期は LocalStorage で保持（匿名）

## Phase 3: 高度な機能実装

### 7. 出走予定と通知機能（低優先度・Web Push）

- [ ] 出走予定カレンダー表示
- [ ] お気に入り選手の出走通知機能
- [ ] レース開始前のアラート機能

### 8. 当日レース詳細機能

- [ ] 選手の当日出走レース詳細表示
  - リアルタイムオッズ表示
  - 直前情報表示
  - レース結果自動更新
- [ ] 選手フォーカスのレース結果表示

### 9. 選手関連ニュース機能

- [ ] ニュース情報取得 API 実装（初期はモックデータで対応）
- [ ] 選手関連ニュース表示機能
- [ ] ニュースフィード機能

## Phase 4: UX 向上とパフォーマンス最適化

### 10. パフォーマンス最適化

- [ ] データキャッシュ機能実装（Redis 等）
- [ ] 画像最適化と CDN 対応
- [ ] レスポンシブデザイン対応

### 11. ユーザー体験向上

- [ ] プッシュ通知機能
- [ ] オフライン対応
- [ ] PWA 対応

## 運用・データ

- [ ] 直近 5 年分の過去成績バックフィル用バッチ実装
- [ ] 定期同期ジョブの実装（前日結果取り込み、当日朝の出走予定同期）
- [ ] アクセスの多い選手/レースのキャッシュ方針の具体化

### 12. テストとデプロイ

- [ ] 自動テスト実装（単体テスト、統合テスト）
- [ ] CI/CD パイプライン構築
- [ ] 本番環境デプロイ準備

## 技術的な課題と検討事項

### データ取得戦略

- [ ] bvp-scraper-python の選手データ取得機能調査
- [ ] 選手情報の更新頻度とタイミング検討
- [ ] スクレイピング負荷軽減のためのキャッシュ戦略

### 技術スタック拡張検討

- [ ] データベース選択（PostgreSQL, SQLite 等）
- [ ] 認証システム実装方針（初期: なし/LocalStorage、将来: Google/Apple）
- [ ] フロントエンド状態管理（Redux, Zustand 等）
- [ ] 可視化ライブラリ: Recharts を採用（決定）

## 優先度

**今すぐ着手すべき項目（高優先度）:**

1. 選手検索 API 実装
2. 選手詳細情報 API 実装
3. 基本的な選手検索 UI 実装
4. データベーススキーマ設計

**次のステップ（中優先度）:**

1. 過去成績取得・表示機能
2. お気に入り選手機能（LocalStorage）
3. 成績統計・グラフ表示（Recharts 導入）

**将来的な実装（低優先度）:**

1. 通知機能
2. ニュース機能
3. PWA 対応

## テスト/検証観点（非機能）

- [ ] Chrome（最新）での主要フロー動作確認
- [ ] iOS Safari（iOS 16+）での主要フロー動作確認
